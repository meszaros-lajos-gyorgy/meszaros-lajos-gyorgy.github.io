<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title>iOS test for webkitAudioContext</title>
	<style>
.hidden{
	display : none;
}
	</style>
	<script src="angularless/js/webkit-audio-context-patch.js"></script>
	<script src="angularless/js/micro-scope.js"></script>
</head>
<body>
	<button>Initialize audio system</button>
	<button class="hidden">Play tone for 1 second</button>
	<script>
var ctx;
try{
	ctx = new window.AudioContext;
}catch(e){
	alert('Web Audio API is not supported by this browser.\nTo see, which browsers support the Web Audio API, visit: http://caniuse.com/#feat=audio-api');
}

// ----------

var osc = ctx.createOscillator();
var volume = ctx.createGain();
osc.type = 'sine';
osc.frequency.value = 440;
osc.connect(volume);

volume.gain.value = 0;
volume.connect(ctx.destination);

// ----------

var $scope = new MicroScope();
$scope.registerAll({
	started : false,
	volume : 0
});

$scope.$watch('started', function(e){
	if(e.newValue === true){
		osc.start(0);
	}
});

// ----------

var initButton = document.getElementsByTagName('button')[0];
var playButton = document.getElementsByTagName('button')[1];

initButton.onclick = function(){
	$scope.started = true;
	initButton.className = 'hidden';
	playButton.className = '';
};

playButton.onclick = function(){
	volume.gain.value = 1;
	setTimeout(function(){
		volume.gain.value = 0;
	}, 1000);
};
	</script>
</body>
</html>