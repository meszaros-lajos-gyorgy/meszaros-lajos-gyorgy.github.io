<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title>Monochord</title>
	
	<meta name="viewport" content="width=device-width, user-scalable=no" />
	
	<link rel="stylesheet/less" href="css/style.less" />
	
	<script src="js/lib/less-2.5.3.min.js"></script>
	<script src="js/lib/angular-1.4.4.min.js"></script>
	
	<script src="js/webkit-audio-context-patch.js"></script>
	<script src="js/audio-model.js"></script>
	<script src="js/math.js"></script>
	<script src="js/directives/dragnumber.js"></script>
	<script src="js/directives/holdclick.js"></script>
	<script src="js/app.js"></script>
</head>
<body ng-app="Microtonal">
	<div ng-controller="MonochordCtrl" class="wrapper">
		<header>
			<h1>Monochord</h1>
		</header>
		<div class="edit">
			<div ng-show="stringToEdit.hasOwnProperty('id')">
				<div class="multiplier">
					<button hold-click ng-disabled="!canLowerString(stringToEdit)" ng-click="lowerString(stringToEdit)">-</button>
					<dragnumber ng-model="stringToEdit.multiplier" min="1" max="highestHarmonic" weight="10"></dragnumber>
					<button hold-click ng-disabled="!canRaiseString(stringToEdit)" ng-click="raiseString(stringToEdit)">+</button>
				</div>
				
				<button ng-show="!stringToEdit.muted" ng-click="stringToEdit.muted = true" class="icon speaker-on">mute</button>
				<button ng-show="stringToEdit.muted" ng-click="stringToEdit.muted = false" class="icon speaker-off">unmute</button>
				
				<!-- <input ng-show="set.retune.type === 'manual'" type="radio" autocomplete="off" ng-value="stringToEdit.id" ng-model="set.retune.subject" /> -->
				
				<button ng-click="removeString(stringToEdit.id);stringToEdit={}" class="icon red delete" title="delete string">delete string</button>
			</div>
		</div>
		<div class="main">
			<section class="base-controls">
				<label>Fundamental frequency: <dragnumber min="1" ng-model="baseFrequency" width="5"></dragnumber> Hz</label>
				<label>Master volume: <input type="range" min="0" autocomplete="off" ng-model="baseVolume" />({{baseVolume}}/100)</label>
				<!-- <label>Autostack: <button ng-show="autoStack" ng-click="autoStack=false">enabled</button><button class="off" ng-show="!autoStack" ng-click="autoStack=true">disabled</button></label> -->
				
				<!-- show keyboard -->
			</section>
			
			<section ng-show="presets.tunings" class="presets">
				<h2>Presets</h2>
				
				<label>Tuning: <select autocomplete="off" ng-model="activePresetTuning" ng-options="tuning.name for tuning in presets.tunings"></select></label><br />
				<br />
				<div ng-repeat="tuning in presets.tunings">
					<div ng-show="tuning == activePresetTuning">
						<ul>
							<li ng-repeat="ratio in tuning.ratios"><button ng-click="addPreset(ratio.ratio, defaultVolume)">{{ratio.name + ' (' + ratio.ratio.join(':') + ')'}}</button></li>
						</ul>
					</div>
				</div>
			</section>
			
			<button ng-click="addSet()" class="icon add" title="add a new set">add a new set</button>
			<button class="icon piano" title="open piano">open piano</button>
			
			<ul class="sets">
				<li ng-repeat="set in sets">
					<!--
					<label>Volume <em style="font-weight:normal">{{set.muted ? '(muted)' : ''}}</em>
					<input type="range" class="master" min="0" max="100" autocomplete="off" ng-model="set.volume" /><br /><span style="font-weight:normal">({{set.volume}}/100)</span></label>
					-->
					
					<!-- <span style="float:left;">Ratio known as: <i>{{ratioKnownAs(set)}}</i></span> -->
					
					{{freqs = calculateFrequencies(set);cents = calculateCents(set);''}}
					<ul class="strings">
						<li ng-repeat="string in set.strings">
							<span class="hertz">{{freqs[$index]|number:0}} Hz</span>
							<button ng-click="setStringToEdit(string)" ng-class="[(stringToEdit.id === string.id ? 'active' : ''), (string.muted ? ' muted' : 'unmuted')]">{{string.multiplier}}</button>
							<span class="cent" ng-show="$index > 0">
								{{cents[$index] - cents[$index - 1] >= 0 ? '+' : ''}}{{cents[$index] - cents[$index - 1] | number:2}} &cent;
							</span>
						</li>
					</ul>
					<button ng-click="addString(set.id)" class="icon add" title="add string">add string</button>
					<button hold-click ng-disabled="!canHalveHarmonics(set)" ng-click="halveHarmonics(set.id)" class="icon halve" title="halve all">halve all</button>
					<button hold-click ng-disabled="!canLowerHarmonics(set)" ng-click="lowerHarmonics(set.id)" class="icon decrease" title="lower all">lower all</button>
					<button hold-click ng-disabled="!canRaiseHarmonics(set)" ng-click="raiseHarmonics(set.id)" class="icon increase" title="raise all">raise all</button>
					<button hold-click ng-disabled="!canDoubleHarmonics(set)" ng-click="doubleHarmonics(set.id)" class="icon double" title="double all">double all</button>
					
					<!--
					/*
					<button ng-disabled="!set._.selectedKey" ng-show="!isSetAssignedToKey(set.id)" ng-click="assignSetToKey(set.id, set._.selectedKey)">assign to key:</button>
					<select ng-class="isSetAssignedToKey(set.id) ? 'hidden' : ''" ng-model="set._.selectedKey" ng-options="key as data.label disable when data.setId > 0 for (key, data) in keyAssignments"></select>
					<button ng-show="isSetAssignedToKey(set.id)" ng-click="unassignSetFromKeys(set.id)">unassign from key <b>{{keyAssignments[getAssignedKeyOfSet(set.id)].label}}</b></button>
					*/
					-->
					
					<!--
					Type: <select autocomplete="off" ng-model="set.retune.type">
						<option value="off">none</option>
						<option value="lowest">(auto) lowest harmony</option>
						<option value="highest">(auto) highest harmony</option>
						<option value="manual">(manual) user select</option>
					</select><br />
					Target: <select autocomplete="off" ng-model="set.retune.target" ng-options="value.value as value.label group by value.group for value in _retuneStringTargets[set.id]"></select>
					-->
					
					<button ng-disabled="!canBeNormalized(set)" ng-click="normalize(set.id)" class="icon normalize" title="normalize ratios">normalize ratios</button>
					<button class="icon tuning-fork" title="retune this set">retune this set</button>
					<button ng-click="removeSet(set.id)" class="icon red delete" title="delete this set">delete this set</button>
				</li>
			</ul>
		</div>
		<div class="dialog">
			<div class="retune">
				
			</div>
		</div>
		<div class="keyboard">
			<h2>Keyboard</h2>
			<!-- double tap on key = toggle key hold -->
			<!-- table layout for the keys -->
			<ul>
				<li></li>
			</ul>
		</div>
	</div>
</body>
</html>